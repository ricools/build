name: Build Armbian Image

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v4

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y \
          git gpg pv p7zip-full zip unzip xz-utils \
          curl wget jq sed bc bison flex make gcc g++ \
          qemu-user-static debootstrap python3 \
          libssl-dev libncurses-dev liblz4-tool \
          binfmt-support

    - name: Clone Armbian Build
      run: |
        git clone --depth 1 https://github.com/armbian/build armbian

    - name: Build Armbian (direct compile)
      run: |
        cd armbian
        ./compile.sh BOARD=aml-s9xx-box \
                      BRANCH=current \
                      RELEASE=jammy \
                      BUILD_MINIMAL=yes \
                      BUILD_DESKTOP=no \
                      KERNEL_ONLY=no \
                      KERNEL_CONFIGURE=no \
                      COMPRESS_OUTPUTIMAGE=sha,img,xz

    - name: Upload image
      uses: actions/upload-artifact@v4
      with:
        name: armbian-flashable
        path: armbian/output/images/*
